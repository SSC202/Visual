# PCL-C++ 6_点云分割(2)—点云聚类

点云分割（聚类）是根据空间、几何和纹理等特征对点云进行划分，使得同一划分区域内的点云拥有相似的特征 。 点云的有效分割往往是许多应用的前提。例如，在逆向工程CAD/CAM 领域，对零件的不同扫描表面进行分割，然后才能更好地进行孔洞修复、曲面重建、特征描述和提取，进而进行基于 3D内容的检索、组合重用等。在激光遥感领域，同样需要对地面、物体首先进行分类处理，然后才能进行后期地物的识别、重建。

PCL 库内现有实现的是鲁棒性比较好的 Cluster 聚类分割和 RANSAC 基于随机采样一致性的分割。

## 1. Cluster 聚类

Cluster 聚类是基于欧氏距离聚类的聚类算法。为了加速该聚类算法，通常配合 KNN 使用。

![NULL](./assets/picture_1.jpg)

距离判断准则为欧氏距离。对于空间某点 $P$ ，通过 KNN 算法找到 $k$ 个离 $P$ 点最近的点，这些点中距离小于设定阈值的便聚类到集合 $Q$ 中。如果 $Q$ 中元素的数目不在增加，整个聚类过程便结束；否则须在集合 $Q$ 中选取 $P$ 点以外的点，重复上述过程，直到 $Q$ 中元素的数目不在增加为止。

欧式聚类比较适用于**没有连通性的点云聚类分割**。因此，对于现实中的大场景点云，通常需要使用渐进式形态学滤波、简单形态滤波(SMRF)算法或CSF布料模拟算法进行地面点的滤除。（或者先使用平面分割法去除大平面）

```c++
pcl::EuclideanClusterExtraction<pcl::PointXYZ> ec;// 欧式聚类对象

ec.setClusterTolerance(0.02);                     // 设置近邻搜索的搜索半径为2cm（也即两个不同聚类团点之间的最小欧氏距离）
ec.setMinClusterSize(100);                        // 设置一个聚类需要的最少的点数目为100
ec.setMaxClusterSize(25000);                      // 设置一个聚类需要的最大点数目为25000
ec.setSearchMethod(tree);                         // 设置点云的搜索机制
ec.setInputCloud(cloud_filtered);
    ec.extract(cluster_indices);                      // 从点云中提取聚类，并将点云索引保存在cluster_indices中

```

